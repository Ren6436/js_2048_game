class e{#e;constructor(e){e.style.setProperty("--grid-size",4),e.style.setProperty("--cell-size","12vmin"),e.style.setProperty("--cell-gap","2vmin"),this.#e=(function(e){let t=[];for(let l=0;l<16;l++){let l=document.createElement("div");l.classList.add("cell"),t.push(l),e.append(l)}return t})(e).map((e,l)=>new t(e,l%4,Math.floor(l/4)))}get cells(){return this.#e}get cellsByColumn(){return this.#e.reduce((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e),[])}get cellsByRow(){return this.#e.reduce((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e),[])}get #t(){return this.#e.filter(e=>null==e.tile)}randomEmptyCell(){let e=Math.floor(Math.random()*this.#t.length);return this.#t[e]}}class t{#l;#s;#i;#r;#n;constructor(e,t,l){this.#l=e,this.#s=t,this.#i=l}get x(){return this.#s}get y(){return this.#i}get tile(){return this.#r}set tile(e){this.#r=e,null!=e&&(this.#r.x=this.#s,this.#r.y=this.#i)}get mergeTile(){return this.#n}set mergeTile(e){this.#n=e,null!=e&&(this.#n.x=this.#s,this.#n.y=this.#i)}canAccept(e){return null==this.tile||null==this.mergeTile&&this.tile.value===e.value}mergeTiles(){null!=this.tile&&null!=this.mergeTile&&(this.tile.value=this.tile.value+this.mergeTile.value,this.mergeTile.remove(),this.mergeTile=null)}}class l{#o;#s;#i;#a;constructor(e,t=Math.random()>.5?2:4){this.#o=document.createElement("div"),this.#o.classList.add("tile"),e.append(this.#o),this.value=t}get value(){return this.#a}set value(e){this.#a=e,this.#o.textContent=e;let t=100-9*Math.log2(e);this.#o.style.setProperty("--background-lightness",`${t}%`),this.#o.style.setProperty("--text-lightness",`${t<=50?90:10}%`)}set x(e){this.#s=e,this.#o.style.setProperty("--x",e)}set y(e){this.#i=e,this.#o.style.setProperty("--y",e)}remove(){this.#o.remove()}waitForTransition(e=!1){return new Promise(t=>{this.#o.addEventListener(e?"animationend":"transitionend",t,{once:!0})})}}const s=document.getElementById("game-board"),i=document.querySelector(".button"),r=document.querySelector(".game-score"),n=document.querySelector(".game-best"),o=document.querySelector(".message-start"),a=document.querySelector(".message-win"),c=document.querySelector(".message-lose"),u=document.querySelector(".message-end");let m=new e(s),h=0,d=0,y=+localStorage.getItem("bestScore")||0;function g(){window.addEventListener("keydown",f,{once:!0})}async function f(e){switch(e.key){case"ArrowUp":if(!v()){g();return}await p(m.cellsByColumn);break;case"ArrowDown":if(!w()){g();return}await p(m.cellsByColumn.map(e=>[...e].reverse()));break;case"ArrowLeft":if(!E()){g();return}await p(m.cellsByRow);break;case"ArrowRight":if(!x()){g();return}await p(m.cellsByRow.map(e=>[...e].reverse()));break;default:g();return}m.cells.forEach(e=>e.mergeTiles());let t=new l(s);if(m.randomEmptyCell().tile=t,!v()&&!w()&&!E()&&!x()){if(!a.classList.contains("hidden")){u.classList.remove("hidden");return}c.classList.remove("hidden");return}g()}function p(e){return Promise.all(e.flatMap(e=>{let t=[];for(let l=1;l<e.length;l++){let s;let i=e[l];if(null!=i.tile){for(let t=l-1;t>=0;t--){let l=e[t];if(!l.canAccept(i.tile))break;s=l}if(null!=s){if(t.push(i.tile.waitForTransition()),null!=s.tile){s.mergeTile=i.tile;let e=s.tile.value+i.tile.value;d+=e,r.textContent=d,d>y&&(y=d,localStorage.setItem("bestScore",y),n.textContent=y),2048===e&&a.classList.remove("hidden")}else s.tile=i.tile;i.tile=null}}}return t}))}function v(){return C(m.cellsByColumn)}function w(){return C(m.cellsByColumn.map(e=>[...e].reverse()))}function E(){return C(m.cellsByRow)}function x(){return C(m.cellsByRow.map(e=>[...e].reverse()))}function C(e){return e.some(e=>e.some((t,l)=>0!==l&&null!=t.tile&&e[l-1].canAccept(t.tile)))}n.textContent=y,i.addEventListener("click",function(){for(;s.firstChild;)s.removeChild(s.firstChild);(m=new e(s)).randomEmptyCell().tile=new l(s),m.randomEmptyCell().tile=new l(s),h=0,r.textContent=h,i.classList.replace("start","restart"),i.textContent="Restart",o.classList.add("hidden"),c.classList.add("hidden"),a.classList.add("hidden"),u.classList.add("hidden"),i.blur(),g()});
//# sourceMappingURL=index.4b8579e7.js.map
